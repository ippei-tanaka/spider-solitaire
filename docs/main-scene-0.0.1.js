(self.webpackChunkspider_solitaire=self.webpackChunkspider_solitaire||[]).push([[563],{187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(){void 0!==a&&e.removeListener("error",a),r([].slice.call(arguments))}var a;"error"!==t&&(a=function(r){e.removeListener(t,i),n(r)},e.once("error",a)),e.once(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,a,o,u;if(s(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=a[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=p(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,a,o;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},539:(e,t,r)=>{"use strict";r.d(t,{z:()=>u});var n=r(655),i=r(260),a=r.n(i)().GameObjects,o=a.Text,s=a.Container,c=a.Rectangle,u=function(e){function t(t){var r=t.scene,n=t.x,i=t.y,a=t.label,o=e.call(this,r,n,i)||this;return o._disabled=!1,o.render(a),o}return(0,n.ZT)(t,e),t.prototype.render=function(e){var t=new o(this.scene,0,0,e,{fontSize:"21px",color:"#000000",fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}),r=new c(this.scene,0,0,t.width+30,t.height+20);r.setFillStyle(16777215,1),r.setStrokeStyle(2,0),this.add(r),t.x-=t.width/2,t.y-=t.height/2,this.add(t),this.setSize(r.width,r.height),this.setInteractive(),this.on("pointerover",(function(){r.setStrokeStyle(2,16711680)})),this.on("pointerout",(function(){r.setStrokeStyle(2,0)}))},t.prototype.disable=function(){this._disabled=!0,this.setAlpha(.5),this.disableInteractive()},t.prototype.enable=function(){this._disabled=!1,this.setAlpha(1),this.setInteractive()},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),t}(s)},257:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var n=Object.freeze({"five-suits":{numberOfTableauPiles:10,numberOfDrawPiles:5,numberOfSuitStacks:8,numberOfSuits:5},"four-suits":{numberOfTableauPiles:10,numberOfDrawPiles:5,numberOfSuitStacks:8,numberOfSuits:4},"two-suits":{numberOfTableauPiles:10,numberOfDrawPiles:5,numberOfSuitStacks:8,numberOfSuits:2},"one-suits":{numberOfTableauPiles:10,numberOfDrawPiles:5,numberOfSuitStacks:8,numberOfSuits:1}})},314:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>H});var n,i=r(655),a=r(260),o=r.n(a),s=r(187),c=function(){function e(){this.emitter=new s.EventEmitter}return e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e,t){this.emitter.emit(e,t)},e}();!function(e){e.Spade="♠",e.Club="♣",e.Diamond="♦",e.Heart="♥",e.Star="★"}(n||(n={}));var u=function(){function e(e){var t=e.suit,r=e.rank,n=e.isFaceUp,i=e.id;if(this._emitter=new c,this._suit=t,this._isFaceUp=n||!1,this._id=i||r+Date.now()+"",!(1<=r&&r<=13))throw new Error("The card rank "+r+" is invalid.");this._rank=r}return Object.defineProperty(e.prototype,"suit",{get:function(){return this._suit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"suitMark",{get:function(){return this._suit.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rank",{get:function(){return this._rank},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rankMark",{get:function(){return function(e){if(e<1||13<e)throw new Error("Card rank is invalid.");return 1===e?"A":11===e?"J":12===e?"Q":13===e?"K":e.toString()}(this._rank)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFaceUp",{get:function(){return this._isFaceUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),e.prototype.faceUp=function(){this._isFaceUp=!0,this._emitter.emit("FLIP_OVER_CARD",{card:this})},e.prototype.faceDown=function(){this._isFaceUp=!1,this._emitter.emit("FLIP_OVER_CARD",{card:this})},e.prototype.flipOver=function(){this._isFaceUp=!this._isFaceUp,this._emitter.emit("FLIP_OVER_CARD",{card:this})},e.prototype.onFlipOver=function(e){this._emitter.on("FLIP_OVER_CARD",e)},e.prototype.toString=function(){return this.suitMark+this.rankMark+(this._isFaceUp?"+":"-")},e}(),l=o().GameObjects,d=l.Text,h=l.Rectangle,f=l.Container,p=function(e){switch(e){case n.Spade:case n.Club:return"#000000";case n.Diamond:case n.Heart:return"#ff0000";case n.Star:return"#0951f7"}},m=function(e){function t(t){var r=t.scene,n=t.x,i=t.y,a=t.suit,o=t.rank,s=t.isFaceUp,c=t.name,u=e.call(this,r,n,i)||this;return u._isHighLighted=!1,u.render(a,o),u.name=c,u._suit=a,u._rank=o,u.back.visible=!s,u}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"suit",{get:function(){return this._suit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rank",{get:function(){return this._rank},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){if(!this._frame)throw new Error;return this._frame},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"back",{get:function(){if(!this._back)throw new Error;return this._back},enumerable:!1,configurable:!0}),t.prototype.render=function(e,r){var i=new h(this.scene,0,0,t.WIDTH,t.HEIGHT,16777215);i.setStrokeStyle(2,0),this.add(i),this._frame=i;var a=new d(this.scene,-36,-59,function(e){return 1===e?"A":11===e?"J":12===e?"Q":13===e?"K":e.toString()}(r)+function(e){switch(e){case n.Spade:return"♠";case n.Club:return"♣";case n.Diamond:return"♦";case n.Heart:return"♥";case n.Star:return"★"}}(e),{fontSize:"32px",color:p(e),fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'});this.add(a),this._back=new f(this.scene,0,0);var o=new h(this.scene,0,0,t.WIDTH-20,t.HEIGHT-20,11184810);o.setStrokeStyle(3,11184810);var s=new h(this.scene,0,0,t.WIDTH-2,t.HEIGHT-2,16777215);this.back.add(s),this.back.add(o),this.add(this.back),this.setSize(t.WIDTH,t.HEIGHT),this.setInteractive({draggable:!0})},t.prototype.flipOver=function(e,t){var r=this;return new Promise((function(n){var i=r.scene.tweens.createTimeline();i.add({targets:r,props:{scaleX:0},duration:.5*t,onComplete:function(){r.back.visible=!e}}),i.add({targets:r,props:{scaleX:1},duration:.5*t,onComplete:function(){n()}}),i.play()}))},Object.defineProperty(t.prototype,"isFaceUp",{get:function(){return!this.back.visible},enumerable:!1,configurable:!0}),t.prototype.addHighlight=function(){this.frame.setStrokeStyle(2,16711680),this._isHighLighted=!0},t.prototype.removeHighlight=function(){this.frame.setStrokeStyle(2,0),this._isHighLighted=!1},Object.defineProperty(t.prototype,"isHighLighted",{get:function(){return this._isHighLighted},enumerable:!1,configurable:!0}),t.WIDTH=75,t.HEIGHT=110,t}(f),b=function(e){for(var t=e.parentContainer,r=e.x,n=e.y;t;)r+=t.x,n+=t.y,t=t.parentContainer;return{x:r,y:n}},_=function(e){function t(t){var r=t.scene,n=t.x,i=t.y,a=t.name,o=t.isSpread,s=t.isDropTarget,c=t.showBottom,u=e.call(this,r,n,i)||this;return u._isSpread=!1,u._cardGameObjects=[],u.name=a,o&&(u._isSpread=!0),s&&(u._zone=u.renderZone(),u.resizeZone()),c&&(u._bottom=u.renderBottom()),u}return(0,i.ZT)(t,e),t.prototype.renderZone=function(){var e=new(o().GameObjects.Zone)(this.scene,0,0,1,1);return this.add(e),e},t.prototype.renderBottom=function(){var e=new(o().GameObjects.Rectangle)(this.scene,0,0,m.WIDTH,m.HEIGHT,16777215,.5);return this.add(e),e},t.prototype.resizeZone=function(){var e=m.WIDTH+t.LENIENCY_FOR_ZONE_WIDTH,r=this._cardGameObjects[this._cardGameObjects.length-1],n=m.HEIGHT+(r?r.y:0)+t.LENIENCY_FOR_ZONE_HEIGHT,i=.5*n-.5*m.HEIGHT;this._zone&&(this._zone.x=0,this._zone.y=i,this._zone.width=e,this._zone.height=n,this._zone.setRectangleDropZone(e,n),this._zone.input.hitArea.setSize(e,n),this._zone.setOrigin(this._zone.originX,this._zone.originY)),this._zoneRect&&(this._zoneRect.x=0,this._zoneRect.y=i,this._zoneRect.width=e,this._zoneRect.height=n,this._zoneRect.setOrigin(this._zoneRect.originX,this._zoneRect.originY))},Object.defineProperty(t.prototype,"zone",{get:function(){return this._zone},enumerable:!1,configurable:!0}),t.prototype._getAdjustedCardGameObjectPositions=function(){if(!this._isSpread||this._cardGameObjects.length<=1)return this._cardGameObjects.map((function(e,t){return{x:0,y:0,depth:t,cardGameObject:e}}));var e=t.FACE_UP_CARD_GAP,r=t.FACE_DOWN_CARD_GAP,n=t.MAX_HEIGHT_OF_GAPS,a=this._cardGameObjects.length-1,o=this._cardGameObjects.slice(0,-1).reduce((function(e,t){return e+(t.isFaceUp?1:0)}),0),s=a-o,c=e,u=r;o*e+s*r>n&&(c=n/(o+s*r/e),u=n/(s+o*e/r));for(var l=0,d=[],h=0;h<this._cardGameObjects.length;h++){var f=this._cardGameObjects[h];d=(0,i.pr)(d,[{x:0,y:l,cardGameObject:f}]),l+=f.isFaceUp?c:u}return d},t.prototype.adjustCardGameObjectPositionsWithAnimation=function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t,r=this;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return t=this._getAdjustedCardGameObjectPositions(),[4,Promise.all(t.filter((function(e){return e.x!==e.cardGameObject.x||e.y!==e.cardGameObject.y})).map((function(t){return new Promise((function(n){r.scene.tweens.add({targets:t.cardGameObject,props:{x:t.x,y:t.y},duration:e,onComplete:function(){return n()}})}))}))).then((function(){return r.resizeZone()}))];case 1:return n.sent(),[2]}}))}))},t.prototype.adjustCardGameObjectPositions=function(){for(var e=0,t=this._getAdjustedCardGameObjectPositions();e<t.length;e++){var r=t[e];r.cardGameObject.x=r.x,r.cardGameObject.y=r.y}this.resizeZone()},t.prototype.expandWithAnimation=function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t=this;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r){t.scaleX=1,t.scaleY=1,t.scene.tweens.add({targets:t,props:{scaleX:1.1,scaleY:1.1},duration:e,onComplete:function(){return r()}})}))];case 1:return r.sent(),[2]}}))}))},t.prototype.getNewFrontCardGameObjectPosition=function(){var e=this._getAdjustedCardGameObjectPositions(),r=e[e.length-1];return r?{x:0,y:r.y+t.FACE_UP_CARD_GAP}:{x:0,y:0}},t.prototype.placeCardGameObjects=function(e){for(var t=e.cardGameObjects,r=b(this),n=0;n<t.length;n++){var a=t[n];a.x=a.x-r.x,a.y=a.y-r.y,this.add(a)}this._cardGameObjects=(0,i.pr)(this._cardGameObjects,t)},t.prototype.getFrontGameObjects=function(e){var t=e.size;return this._cardGameObjects.slice(-t)},t.prototype.removeFrontGameObjects=function(e){for(var t=e.size,r=this.getFrontGameObjects({size:t}),n=b(this),i=0;i<r.length;i++){var a=r[i];a.x=a.x+n.x,a.y=a.y+n.y,this.remove(a)}this._cardGameObjects=this._cardGameObjects.slice(0,this._cardGameObjects.length-t),this.resizeZone()},t.prototype.drawFrontCardGameObjects=function(e){var t=e.size,r=this.getFrontGameObjects({size:t});return this.removeFrontGameObjects({size:t}),r},Object.defineProperty(t.prototype,"cardGameObjects",{get:function(){return(0,i.pr)(this._cardGameObjects)},enumerable:!1,configurable:!0}),t.FACE_DOWN_CARD_GAP=17,t.FACE_UP_CARD_GAP=33,t.MAX_HEIGHT=570,t.MAX_HEIGHT_OF_GAPS=t.MAX_HEIGHT-m.HEIGHT,t.LENIENCY_FOR_ZONE_HEIGHT=.5*m.HEIGHT,t.LENIENCY_FOR_ZONE_WIDTH=.1*m.WIDTH,t}(o().GameObjects.Container),y=25,g=function(e){function t(t){var r=t.scene,n=t.deckPileName,a=t.drawPilesNames,o=t.tableauPilesNames,s=t.discardPilesNames,c=t.dragPileName,u=t.hintPileName,l=t.cardGameObjects,d=e.call(this,r,0,0)||this;d._cardGameObjects=[],d._pileGameObjects=[],d._drawPileGameObjects=[],d._tableauPileGameObjects=[],d._discardPileGameObjects=[],d.scene.sys.game.canvas.width,d.scene.sys.game.canvas.height,d._cardGameObjects=l;var h=new _({scene:d.scene,x:500,y:500,name:n});d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[h]),d._deckPileGameObject=h,d._deckPileGameObject.placeCardGameObjects({cardGameObjects:l}),d._deckPileGameObject.adjustCardGameObjectPositions(),d.add(h);for(var f=0;f<a.length;f++){var p=new _({scene:d.scene,x:.5*m.WIDTH+y,y:.5*m.HEIGHT+y+f*_.FACE_DOWN_CARD_GAP,name:a[f]});d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[p]),d._drawPileGameObjects=(0,i.pr)(d._drawPileGameObjects,[p]),d.add(p)}for(f=0;f<o.length;f++){var b=new _({scene:d.scene,x:.5*m.WIDTH+y+m.WIDTH+25+f*(m.WIDTH+11),y:.5*m.HEIGHT+y,name:o[f],isSpread:!0,isDropTarget:!0,showBottom:!0});d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[b]),d._tableauPileGameObjects=(0,i.pr)(d._tableauPileGameObjects,[b]),d.add(b)}for(f=0;f<s.length;f++){var g=new _({scene:d.scene,x:.5*m.WIDTH+y,y:.5*m.HEIGHT+y+m.HEIGHT+(a.length-1)*_.FACE_DOWN_CARD_GAP+25+f*_.FACE_DOWN_CARD_GAP,name:s[f]});d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[g]),d._discardPileGameObjects=(0,i.pr)(d._discardPileGameObjects,[g]),d.add(g)}var O=new _({scene:d.scene,x:0,y:0,name:c,isSpread:!0});d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[O]),d._dragPileGameObject=O,d._dragPileGameObject.setActive(!1),d.add(O);var v=new _({scene:d.scene,x:0,y:0,name:u,isSpread:!0});return d._pileGameObjects=(0,i.pr)(d._pileGameObjects,[v]),d._hintPileGameObject=v,d._hintPileGameObject.setActive(!1),d.add(v),d}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"cardGameObjects",{get:function(){return(0,i.pr)(this._cardGameObjects)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pileGameObjects",{get:function(){return(0,i.pr)(this._pileGameObjects)},enumerable:!1,configurable:!0}),t.prototype.getPileGameObjectBy=function(e){var t=this._pileGameObjects.find(e);if(!t)throw new Error("The pile game object doesn't exist.");return t},t.prototype.getPileGameObjectByName=function(e){return this.getPileGameObjectBy((function(t){return t.name===e}))},t.prototype.getPileGameObjectByCardGameObjectName=function(e){return this.getPileGameObjectBy((function(t){return t.cardGameObjects.find((function(t){return t.name===e}))}))},Object.defineProperty(t.prototype,"deckPileGameObject",{get:function(){return this._deckPileGameObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawPileGameObjects",{get:function(){return(0,i.pr)(this._drawPileGameObjects)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableauPileGameObjects",{get:function(){return(0,i.pr)(this._tableauPileGameObjects)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dragPileGameObject",{get:function(){return this._dragPileGameObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hintPileGameObject",{get:function(){return this._hintPileGameObject},enumerable:!1,configurable:!0}),t}(o().GameObjects.Container),O=r(539),v=function(){function e(e){void 0===e&&(e={}),this._cards=e.cards||[],this._name=e.label||""}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cards",{get:function(){return(0,i.pr)(this._cards)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontCard",{get:function(){return this._cards[this._cards.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastCard",{get:function(){return this._cards[0]},enumerable:!1,configurable:!0}),e.prototype.getFrontCards=function(e){var t=e.size,r=this._cards;if(0===r.length||t<1)return[];var n=Math.min(r.length,t);return r.slice(r.length-n)},e.prototype.drawCards=function(e){var t=e.size,r=this._cards;if(0===r.length||t<1)return[];var n=Math.min(r.length,t),i=r.slice(r.length-n);return this._cards=r.slice(0,-t),i},e.prototype.placeCards=function(e){var t=e.cards;this._cards=(0,i.pr)(this._cards,t)},e.prototype.getDescendingInSuitFrontCards=function(){return e.getDescendingFrontCards({cards:this._cards,inSuit:!0,faceUp:!0})},e.getDescendingFrontCards=function(e){var t=e.cards,r=e.inSuit||!1,n=e.faceUp||!1;if(0===t.length)return[];var a=t[t.length-1];if(n&&!a.isFaceUp)return[];for(var o=[a],s=t.length-2;s>=0;s--){var c=t[s];if(a.rank+1!==c.rank||r&&a.suit!==c.suit||n&&!c.isFaceUp)break;o=(0,i.pr)([c],o),a=c}return o},e.checkIfCardsAreDescending=function(t){var r=t.cards,n=t.inSuit,i=t.faceUp;return e.getDescendingFrontCards({cards:r,inSuit:n,faceUp:i}).length===r.length},e.prototype.checkIfFrontCardsComplete=function(){return this.cards.length>=13&&e.checkIfCardsAreDescending({cards:this.cards.slice(-13),inSuit:!0,faceUp:!0})},e.prototype.toString=function(){return this.cards.map((function(e){return e.toString()})).join(" ")},e}(),j="FACE_UP_CARD",P="MOVE_CARD",G="PAUSE",C=function(){function e(){this._actions=[],this._emitter=new c}return e.prototype.add=function(e){this._actions=(0,i.pr)(this._actions,[e]),this._emitter.emit("ADD",e)},e.prototype.remove=function(){var e=this._actions.slice(-1)[0];this._actions=this._actions.slice(0,-1),this._emitter.emit("REMOVE",e)},e.prototype.onAdd=function(e){this._emitter.on("ADD",e)},e.prototype.onRemove=function(e){this._emitter.on("REMOVE",e)},Object.defineProperty(e.prototype,"latest",{get:function(){return 0===this._actions.length?void 0:this._actions[this._actions.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return(0,i.pr)(this._actions)},enumerable:!1,configurable:!0}),e}(),w=function(e){switch(e.type){case j:return{t:"F",c:e.card.id};case P:return{t:"M",f:e.from.name,o:e.to.name,s:e.size+""};default:return{t:"P"}}},A=function(e){var t=e.simplifiedUndoableAction,r=e.cardFinder,n=e.pileFinder;switch(t.t){case"F":return{type:j,card:r(t.c||"")};case"M":return{type:P,from:n(t.f||""),to:n(t.o||""),size:parseInt(t.s||"")};case"P":default:return{type:G}}},E=function(){function e(e){var t=this;this._emitter=new c,this._settings=e,this._cards=e.cards,this._deckPile=new v({label:"deck",cards:e.cards}),this._drawPiles=Array.from({length:e.numberOfDrawPiles}).map((function(e,t){return new v({label:"draw"+t,cards:[]})})),this._tableauPiles=Array.from({length:e.numberOfTableauPiles}).map((function(e,t){return new v({label:"tabl"+t,cards:[]})})),this._discardPiles=Array.from({length:Math.floor(e.cards.length/13)}).map((function(e,t){return new v({label:"disc"+t,cards:[]})})),this._piles=(0,i.pr)([this._deckPile],this._drawPiles,this.tableauPiles,this._discardPiles),this._actionHistory=new C,this._simplifiedUndoableActions=[],this._actionHistory.onAdd((function(e){t._simplifiedUndoableActions=(0,i.pr)(t._simplifiedUndoableActions,[w(e)]),t._emitter.emit("ACTION_HAPPEN",void 0)})),this._actionHistory.onRemove((function(){t._simplifiedUndoableActions=t._simplifiedUndoableActions.slice(0,-1),t._emitter.emit("ACTION_HAPPEN",void 0)}))}return Object.defineProperty(e.prototype,"cards",{get:function(){return(0,i.pr)(this._cards)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"piles",{get:function(){return(0,i.pr)(this._piles)},enumerable:!1,configurable:!0}),e.prototype.getPileBy=function(e){var t=this._piles.find(e);if(!t)throw new Error("The pile doesn't exist.");return t},e.prototype.getPileByName=function(e){return this.getPileBy((function(t){return t.name===e}))},e.prototype.getPileByCardId=function(e){return this.getPileBy((function(t){return!!t.cards.find((function(t){return t.id===e}))}))},e.prototype.getCardBy=function(e){var t=this._cards.find(e);if(!t)throw new Error("The card doesn't exist.");return t},e.prototype.getCardById=function(e){return this.getCardBy((function(t){return t.id===e}))},Object.defineProperty(e.prototype,"deckPile",{get:function(){return this._deckPile},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawPiles",{get:function(){return(0,i.pr)(this._drawPiles)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableauPiles",{get:function(){return(0,i.pr)(this._tableauPiles)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"discardPiles",{get:function(){return(0,i.pr)(this._discardPiles)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClear",{get:function(){return!this._tableauPiles.find((function(e){return e.cards.length>0}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actionHistory",{get:function(){return this._actionHistory},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"simplifiedUndoableActions",{get:function(){return this._simplifiedUndoableActions},enumerable:!1,configurable:!0}),e.prototype._moveCardBetweenPiles=function(e){var t=e.from,r=e.to,n=e.size;if(!this._piles.find((function(e){return e===t})))throw new Error('The "from" pile is not be in this table.');if(!this._piles.find((function(e){return e===r})))throw new Error('The "to" pile is not be in this table.');if(t.getFrontCards({size:n}).length!==n)throw new Error('The pile "'+t.name+"\" doesn't have "+n+" cards to draw.");var i=t.drawCards({size:n});r.placeCards({cards:i}),this._emitter.emit("MOVE_CARDS_BETWEEN_PILES",{from:t,to:r,size:n})},e.prototype._dealCardsFromDeckToTableauPiles=function(){for(var e=this._deckPile.cards.length,t=this._settings.numberOfTableauPiles*this._settings.numberOfDrawPiles,r=0,n=0;n<e-t;n++){var i=this._deckPile,a=this._tableauPiles[r%this.tableauPiles.length];this._moveCardBetweenPiles({from:i,to:a,size:1}),r+=1}},e.prototype._dealCardsFromDeckToDrawPiles=function(){for(var e=0;e<this._settings.numberOfDrawPiles;e++){var t=this._deckPile,r=this._drawPiles[e];this._moveCardBetweenPiles({from:t,to:r,size:this._settings.numberOfTableauPiles})}},e.prototype._flipUpTableauFrontCards=function(){for(var e=0,t=this._tableauPiles;e<t.length;e++){var r=t[e];r.frontCard&&this._faceUpCard({card:r.frontCard})}},e.prototype._faceUpCard=function(e){var t=e.card;t.isFaceUp||t.faceUp()},e.prototype.startGame=function(){this._dealCardsFromDeckToTableauPiles(),this._dealCardsFromDeckToDrawPiles(),this._flipUpTableauFrontCards()},e.prototype.moveCardBetweenTableauPiles=function(e){var t=e.from,r=e.to,n=e.size;if(!this._tableauPiles.find((function(e){return e===t})))throw new Error('The "from" pile is not a tableau pile.');if(!this._tableauPiles.find((function(e){return e===r})))throw new Error('The "to" pile is not a tableau pile.');var a=t.getFrontCards({size:n});if(a.length!==n)throw new Error('The pile "'+t.name+"\" doesn't have "+n+" cards to draw.");if(r.frontCard&&!v.checkIfCardsAreDescending({cards:(0,i.pr)([r.frontCard],a),inSuit:!1,faceUp:!0}))throw new Error('You can\'t place those cards to the "to" pile.');this._moveCardBetweenPiles({from:t,to:r,size:n}),this._actionHistory.add({from:t,to:r,size:n,type:P}),t.frontCard&&!t.frontCard.isFaceUp&&(this._faceUpCard({card:t.frontCard}),this._actionHistory.add({card:t.frontCard,type:j}));var o=this._discardPiles.find((function(e){return 0===e.cards.length}));if(!o)throw new Error("There aren't any empty discarded piles.");if(r.checkIfFrontCardsComplete()){for(var s=0;s<13;s++)this._moveCardBetweenPiles({from:r,to:o,size:1}),this._actionHistory.add({from:r,to:o,size:1,type:P});r.frontCard&&!r.frontCard.isFaceUp&&(this._faceUpCard({card:r.frontCard}),this._actionHistory.add({card:r.frontCard,type:j}))}this._actionHistory.add({type:G})},Object.defineProperty(e.prototype,"frontDrawPile",{get:function(){for(var e,t=this._drawPiles.length-1;t>=0;t--)if(this._drawPiles[t].cards.length===this._settings.numberOfTableauPiles){e=this._drawPiles[t];break}return e},enumerable:!1,configurable:!0}),e.prototype.dealCardsFromDrawPile=function(){var e=this.frontDrawPile;if(!e)throw new Error("There are no cards to draw from draw piles.");for(var t=0;t<this._tableauPiles.length;t++){var r=this._tableauPiles[t];this._moveCardBetweenPiles({from:e,to:r,size:1}),this._actionHistory.add({from:e,to:r,size:1,type:P})}for(var n=0,i=this._tableauPiles;n<i.length;n++)(r=i[n]).frontCard&&!r.frontCard.isFaceUp&&(this._faceUpCard({card:r.frontCard}),this._actionHistory.add({card:r.frontCard,type:j}));this._actionHistory.add({type:G})},e.prototype.undo=function(){e:for(;e=this._actionHistory.latest;)switch(e.type){case G:this._actionHistory.remove();break;default:break e}e:for(;;){var e;if(!(e=this._actionHistory.latest))break e;switch(e.type){case j:e.card.faceDown(),this._actionHistory.remove();break;case P:this._moveCardBetweenPiles({from:e.to,to:e.from,size:e.size}),this._actionHistory.remove();break;case G:break e}}},e.prototype.getHints=function(){for(var e=[],t=0,r=this._tableauPiles;t<r.length;t++){var n=r[t],a=n.getDescendingInSuitFrontCards();if(0!==a.length)for(var o=0,s=this._tableauPiles;o<s.length;o++){var c=s[o];if(n!==c&&(a.length!==n.cards.length||c.frontCard))for(var u=a.length;u>0;u--)(u===a.length||c.frontCard)&&(c.frontCard&&!v.checkIfCardsAreDescending({cards:(0,i.pr)([c.frontCard],a.slice(-u)),inSuit:!1,faceUp:!0})||(e=(0,i.pr)(e,[{from:n,to:c,size:u}])))}}return e},e.prototype.reproduce=function(e){for(var t=this,r=0;r<e.length;r++){var n=A({simplifiedUndoableAction:e[r],cardFinder:function(e){return t.getCardById(e)},pileFinder:function(e){return t.getPileByName(e)}});switch(n.type){case j:n.card.faceUp(),this._actionHistory.add({card:n.card,type:j});break;case P:this._moveCardBetweenPiles({from:n.from,to:n.to,size:n.size}),this._actionHistory.add({from:n.from,to:n.to,size:n.size,type:P});break;case G:this._actionHistory.add({type:G})}}},e.prototype.onMoveCardsBetweenPiles=function(e){this._emitter.on("MOVE_CARDS_BETWEEN_PILES",e)},e.prototype.onActionHappen=function(e){this._emitter.on("ACTION_HAPPEN",e)},e.prototype.toString=function(){return this._piles.map((function(e){return e.name+" "+e.toString()})).join("\n")},e}(),k=function(e){var t=e.rank,r=e.suit,n=e.isFaceUp;return new u({suit:r,rank:t,isFaceUp:n})},D=function(e){for(var t=e.numberOfSuitStacks,r=e.numberOfSuits,i=[],a=e.mapping||k,o=0;o<t;o++)for(var s=1;s<=13;s++){var c=13*o+s;switch(o%r){case 0:i.push(a({rank:s,suit:n.Spade,isFaceUp:!1,index:c}));break;case 1:i.push(a({rank:s,suit:n.Heart,isFaceUp:!1,index:c}));break;case 2:i.push(a({rank:s,suit:n.Club,isFaceUp:!1,index:c}));break;case 3:i.push(a({rank:s,suit:n.Diamond,isFaceUp:!1,index:c}));break;case 4:i.push(a({rank:s,suit:n.Star,isFaceUp:!1,index:c}))}}return i},S=function(){function e(e){this._onStartCallback=function(){},this._onEndCallback=function(){},this._onFailCallback=function(){},this._onQueueCancelCallback=function(){},this._status=0,this._jobPromiseCreator=e}return e.prototype.start=function(){var e=this;if(this.isUntouched){var t=this._jobPromiseCreator((function(t){return e._onQueueCancelCallback=t}));this._status=1,this._onStartCallback(),t.then((function(t){e._status=2,e._onEndCallback(t)})).catch((function(t){e._status=2,e._onFailCallback(t)}))}},Object.defineProperty(e.prototype,"onStartCallback",{set:function(e){this._onStartCallback=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEndCallback",{set:function(e){this._onEndCallback=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onFailCallback",{set:function(e){this._onFailCallback=e},enumerable:!1,configurable:!0}),e.prototype.runQueueCancelCallback=function(){this._onQueueCancelCallback()},Object.defineProperty(e.prototype,"isUntouched",{get:function(){return 0===this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isProcessing",{get:function(){return 1===this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDone",{get:function(){return 2===this._status},enumerable:!1,configurable:!0}),e}(),F=function(){function e(){this._hasStarted=!1,this._currentIndex=0,this._jobQueue=[],this._emitter=new c}return Object.defineProperty(e.prototype,"isProcessing",{get:function(){return this._hasStarted},enumerable:!1,configurable:!0}),e.prototype.add=function(e){var t=this,r=new S(e);r.onStartCallback=function(){t._emitter.emit("JOB_START",{})},r.onEndCallback=function(e){t._emitter.emit("JOB_END",{value:e}),t._currentIndex=t._currentIndex+1,t._process()},r.onFailCallback=function(e){console.error(e)},this._jobQueue=(0,i.pr)(this._jobQueue,[r]),this._process()},e.prototype._process=function(){if(this._hasStarted||(this._hasStarted=!0,this._emitter.emit("QUEUE_START",{})),this._currentIndex<this._jobQueue.length){var e=this._jobQueue[this._currentIndex];e&&e.isUntouched&&e.start()}else this._hasStarted=!1,this._jobQueue=[],this._currentIndex=0,this._emitter.emit("QUEUE_END",{})},e.prototype.cancel=function(){var e=this._hasStarted,t=this._jobQueue[this._currentIndex];this._hasStarted=!1,this._jobQueue=[],this._currentIndex=0,e&&t&&t.isProcessing?(t.onEndCallback=function(){},t.runQueueCancelCallback(),this._emitter.emit("QUEUE_CANCEL",{actuallyCancelled:!0})):this._emitter.emit("QUEUE_CANCEL",{actuallyCancelled:!1})},e.prototype.onQueueStart=function(e){this._emitter.on("QUEUE_START",e)},e.prototype.onQueueEnd=function(e){this._emitter.on("QUEUE_END",e)},e.prototype.onQueueCancel=function(e){this._emitter.on("QUEUE_CANCEL",e)},e.prototype.onJobStart=function(e){this._emitter.on("JOB_START",e)},e.prototype.onJobEnd=function(e){this._emitter.on("JOB_END",e)},e}(),T=r(257);const H=function(e){function t(){var r=e.call(this,"main")||this;return r._RND=new(o().Math.RandomDataGenerator),r._cardMoveDuration=t.CARD_MOVE_DURATION,r._cardFlipDuration=t.CARD_FLIP_DURATION,r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"_table",{get:function(){if(!this.__table)throw new Error("Table is not ready.");return this.__table},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_tableGameObject",{get:function(){if(!this.__tableGameObject)throw new Error("Table Game Object is not ready.");return this.__tableGameObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cardAnimationQueue",{get:function(){if(!this.__cardAnimationQueue)throw new Error("cardAnimationQueue is not ready.");return this.__cardAnimationQueue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_hintAnimationQueue",{get:function(){if(!this.__hintAnimationQueue)throw new Error("hintAnimationQueue is not ready.");return this.__hintAnimationQueue},enumerable:!1,configurable:!0}),t.prototype.create=function(){var e=this,t=localStorage.getItem("game-mode");if(t&&T.z[t]){var r=T.z[t],n=localStorage.getItem("seed");n?this._RND.state(n):localStorage.setItem("seed",this._RND.state()),this.__table=new E({numberOfTableauPiles:r.numberOfTableauPiles,numberOfDrawPiles:r.numberOfDrawPiles,cards:this._RND.shuffle(D({numberOfSuitStacks:r.numberOfSuitStacks,numberOfSuits:r.numberOfSuits,mapping:function(t){var r=t.rank,n=t.suit,i=t.isFaceUp;return new u({suit:n,rank:r,isFaceUp:i,id:e._RND.uuid()})}}).map((function(t){return t.onFlipOver(e.onFlipOverCard.bind(e)),t})))}),this.__tableGameObject=new g({scene:this,deckPileName:this._table.deckPile.name,drawPilesNames:this._table.drawPiles.map((function(e){return e.name})),tableauPilesNames:this._table.tableauPiles.map((function(e){return e.name})),discardPilesNames:this._table.discardPiles.map((function(e){return e.name})),dragPileName:"drag",hintPileName:"hint",cardGameObjects:this._table.cards.map((function(t){var r=new m({scene:e,x:0,y:0,suit:t.suit,rank:t.rank,name:t.id});return r.on("pointerover",(function(t){return e.onCardPointerOver.call(e,{cardGameObject:r,pointer:t})})),r.on("pointerout",(function(t){return e.onCardPointerOut.call(e,{cardGameObject:r,pointer:t})})),r.on("pointerup",(function(t){return e.onCardPointerUp.call(e,{cardGameObject:r,pointer:t})})),r.on("dragstart",(function(t){return e.onCardDragStart.call(e,{cardGameObject:r,pointer:t})})),r.on("drag",(function(t){return e.onCardDrag.call(e,{cardGameObject:r,pointer:t})})),r.on("drop",(function(t,n){return e.onCardDrop.call(e,{cardGameObject:r,pointer:t,zone:n})})),r.on("dragend",(function(t){return e.onCardDragEnd.call(e,{cardGameObject:r,pointer:t})})),r}))}),this.children.add(this._tableGameObject),this.__cardAnimationQueue=new F,this.__hintAnimationQueue=new F;var i=new O.z({scene:this,x:77,y:520,label:"Undo"});i.on("pointerup",(function(){return e._table.undo()})),this.children.add(i);var a=function(){0===e._table.actionHistory.actions.length||e._cardAnimationQueue.isProcessing||e._hintAnimationQueue.isProcessing?i.disable():i.enable()};this._cardAnimationQueue.onQueueStart(a),this._cardAnimationQueue.onQueueEnd(a),this._cardAnimationQueue.onQueueCancel(a),this._hintAnimationQueue.onQueueStart(a),this._hintAnimationQueue.onQueueEnd(a),this._hintAnimationQueue.onQueueCancel(a),a(),this._table.onActionHappen(a);var o=new O.z({scene:this,x:206,y:520,label:"Hint"});o.on("pointerup",(function(){return e.showHints()})),this.children.add(o),this._cardAnimationQueue.onQueueStart((function(){return o.disable()})),this._cardAnimationQueue.onQueueEnd((function(){return o.enable()})),this._cardAnimationQueue.onQueueCancel((function(){return o.enable()})),this._hintAnimationQueue.onQueueStart((function(){return o.disable()})),this._hintAnimationQueue.onQueueEnd((function(){return o.enable()})),this._hintAnimationQueue.onQueueCancel((function(){return o.enable()})),this.input.on("pointerup",(function(t,r){!r.includes(o)&&e._hintAnimationQueue.isProcessing&&e._hintAnimationQueue.cancel()})),this._table.onMoveCardsBetweenPiles(this.onMoveCardsBetweenPiles.bind(this)),this._table.onActionHappen((function(){localStorage.setItem("actions",JSON.stringify(e._table.simplifiedUndoableActions))})),this._table.startGame();var s=localStorage.getItem("actions");n&&s&&this._table.reproduce(JSON.parse(s));var c=new O.z({scene:this,x:337,y:520,label:"Menu"});c.on("pointerup",(function(){return e.showMenu()})),this.children.add(c)}else this.scene.start("boot")},t.prototype.onCardPointerOver=function(e){var t=e.cardGameObject;if(!this._cardAnimationQueue.isProcessing){var r=this._tableGameObject.getPileGameObjectByCardGameObjectName(t.name);if(t.isFaceUp&&this._tableGameObject.tableauPileGameObjects.includes(r)){var n=this._table.getPileByCardId(t.name),i=this._tableGameObject.getPileGameObjectByName(n.name),a=i.cardGameObjects.length-i.cardGameObjects.indexOf(t);v.checkIfCardsAreDescending({cards:n.cards.slice(-a),faceUp:!0,inSuit:!0})&&t.addHighlight()}else this._table.frontDrawPile&&r===this._tableGameObject.getPileGameObjectByName(this._table.frontDrawPile.name)&&t.addHighlight()}},t.prototype.onCardPointerOut=function(e){e.cardGameObject.removeHighlight()},t.prototype.onCardPointerUp=function(e){var t=e.cardGameObject,r=this._tableGameObject.getPileGameObjectByCardGameObjectName(t.name);this._table.frontDrawPile&&!this._cardAnimationQueue.isProcessing&&this._tableGameObject.getPileGameObjectByName(this._table.frontDrawPile.name)===r&&this._table.dealCardsFromDrawPile()},t.prototype.onCardDragStart=function(e){var t=this,r=e.cardGameObject,n=this._tableGameObject.getPileGameObjectByCardGameObjectName(r.name),a=this._tableGameObject.dragPileGameObject;if(r.isFaceUp&&this._tableGameObject.tableauPileGameObjects.includes(n)&&!a.active){var o=this._table.getPileByCardId(r.name),s=this._tableGameObject.getPileGameObjectByName(o.name),c=s.cardGameObjects.length-s.cardGameObjects.indexOf(r);if(v.checkIfCardsAreDescending({cards:o.cards.slice(-c),faceUp:!0,inSuit:!0})){var u=this._tableGameObject.dragPileGameObject,l=r.y;u.setActive(!0),this._tableGameObject.bringToTop(u),u.x=s.x,u.y=s.y+l,u.placeCardGameObjects({cardGameObjects:s.drawFrontCardGameObjects({size:c})}),this._cardAnimationQueue.add((function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,Promise.all([u.adjustCardGameObjectPositionsWithAnimation(this._cardMoveDuration),u.expandWithAnimation(this._cardMoveDuration)])];case 1:return e.sent(),[2]}}))}))}))}}},t.prototype.onCardDrag=function(e){var t=e.pointer,r=e.cardGameObject,n=this._tableGameObject.getPileGameObjectByCardGameObjectName(r.name),i=this._tableGameObject.dragPileGameObject;if(n===i&&i.active){var a=t.x-t.prevPosition.x,o=t.y-t.prevPosition.y;i.x+=a,i.y+=o}},t.prototype.onCardDrop=function(e){var t=this,r=e.zone,n=e.cardGameObject,a=this._tableGameObject.getPileGameObjectByCardGameObjectName(n.name),o=this._tableGameObject.dragPileGameObject;if(a===o&&o.active){var s=this._table.getPileByCardId(n.name),c=this._tableGameObject.getPileGameObjectByName(s.name),u=this._tableGameObject.getPileGameObjectBy((function(e){return e.zone===r})),l=this._table.getPileByName(u.name),d=o.cardGameObjects.length,h=o.drawFrontCardGameObjects({size:d});c.placeCardGameObjects({cardGameObjects:h});var f=h.map((function(e){var r=t._table.cards.find((function(t){return e.name===t.id}));if(!r)throw new Error("Couldn't find corresponding cards.");return r}));!l.frontCard||v.checkIfCardsAreDescending({cards:(0,i.pr)([l.frontCard],f),faceUp:!0})?(this._table.moveCardBetweenTableauPiles({to:l,from:s,size:d}),o.setActive(!1)):this._cardAnimationQueue.add((function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,c.adjustCardGameObjectPositionsWithAnimation(this._cardMoveDuration)];case 1:return e.sent(),o.setActive(!1),[2]}}))}))}))}},t.prototype.onCardDragEnd=function(e){var t=this,r=e.cardGameObject,n=this._tableGameObject.getPileGameObjectByCardGameObjectName(r.name),a=this._tableGameObject.dragPileGameObject;if(n===a&&a.active){var o=a.cardGameObjects.length,s=this._table.getPileByCardId(r.name),c=this._tableGameObject.getPileGameObjectByName(s.name),u=a.drawFrontCardGameObjects({size:o});c.placeCardGameObjects({cardGameObjects:u}),this._tableGameObject.bringToTop(c),this._cardAnimationQueue.add((function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,c.adjustCardGameObjectPositionsWithAnimation(this._cardMoveDuration)];case 1:return e.sent(),a.setActive(!1),[2]}}))}))}))}},t.prototype.onMoveCardsBetweenPiles=function(e){var t=this,r=e.from,n=e.to,a=e.size,o=this._tableGameObject.getPileGameObjectByName(r.name),s=this._tableGameObject.getPileGameObjectByName(n.name);this._cardAnimationQueue.add((function(){return(0,i.mG)(t,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return e=o.drawFrontCardGameObjects({size:a}),s.placeCardGameObjects({cardGameObjects:e}),this._tableGameObject.bringToTop(s),[4,Promise.all([s.adjustCardGameObjectPositionsWithAnimation(this._cardMoveDuration),o.adjustCardGameObjectPositionsWithAnimation(this._cardMoveDuration)])];case 1:return t.sent(),[2]}}))}))})),this._table.isClear&&this._cardAnimationQueue.add((function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){return setTimeout(e,100)}))];case 1:return e.sent(),this.clearGame(),[2]}}))}))}))},t.prototype.onFlipOverCard=function(e){var t=this,r=e.card,n=this._tableGameObject.cardGameObjects.find((function(e){return e.name===r.id}));n&&this._cardAnimationQueue.add((function(){return n.flipOver(r.isFaceUp,t._cardFlipDuration)}))},t.prototype.showHints=function(){for(var e=this,t=this._table.getHints(),r=this._tableGameObject.hintPileGameObject,n=function(){r.drawFrontCardGameObjects({size:r.cardGameObjects.length}).forEach((function(e){return e.destroy()}))},a=function(t,a,s){o._hintAnimationQueue.add((function(o){return(0,i.mG)(e,void 0,void 0,(function(){var e,c,u,l=this;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return e=this._tableGameObject.getPileGameObjectByName(t.name),c=this._tableGameObject.getPileGameObjectByName(a.name),u=e.getFrontGameObjects({size:s}),r.x=e.x,r.y=e.y+u[0].y,r.placeCardGameObjects({cardGameObjects:u.map((function(e){return new m({x:0,y:0,rank:e.rank,suit:e.suit,isFaceUp:e.isFaceUp,name:"",scene:l})}))}),r.adjustCardGameObjectPositions(),r.setAlpha(.8),this._tableGameObject.bringToTop(r),[4,new Promise((function(e){var t=l.tweens.add({targets:r,props:{x:c.x,y:c.y+c.getNewFrontCardGameObjectPosition().y},duration:800,completeDelay:400,onComplete:function(){e(),n()}});o((function(){t.stop(),n()}))}))];case 1:return i.sent(),[2]}}))}))}))},o=this,s=0,c=t;s<c.length;s++){var u=c[s];a(u.from,u.to,u.size)}},t.prototype.clearGame=function(){this.scene.pause(),localStorage.removeItem("seed"),localStorage.removeItem("actions"),this.scene.launch("gameclear")},t.prototype.showMenu=function(){this.scene.pause(),this.scene.launch("menu")},t.CARD_MOVE_DURATION=80,t.CARD_FLIP_DURATION=80,t}(o().Scene)}}]);